---

  - hosts: tag_Cluster_{{ lookup('env', 'ENVIRONMENT') }}_control

    serial: 1

    tasks:

      - name: initialize the cluster
        command: docker swarm init
        run_once: yes
        ignore_errors: yes

      - name: get manager join token
        command: docker swarm join-token manager --quiet
        register: manager_token
        run_once: yes

      - debug:
          msg: "{{ manager_token.stdout }}"
        run_once: yes
