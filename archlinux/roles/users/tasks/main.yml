---

  - name: set root user shell to zshell
    command: chsh -s /usr/bin/zsh root

  - name: clone sugar-shell repository
    git:
      repo: "{{ sugar_shell }}"
      dest: /usr/local/etc/sugar-shell

  - name: place sugar-shell settings file
    copy:
      src: settings.conf
      dest: /usr/local/etc/sugar-shell/zsh.d/settings.conf

  - name: install sugar-shell for root user
    shell: |
      cd /usr/local/etc/sugar-shell
      ./install.sh

  - name: add users
    user:
      name: "{{ item.name }}"
      group: users
      groups: wheel
    with_items: "{{ users }}"

  - name: set users authorized keys
    authorized_key:
      user: "{{ item.name }}"
      key: "{{ lookup('file', item.key) }}"
      exclusive: yes
    with_items: "{{ users }}"
