---

  - name: wait for consul
    wait_for:
      host: localhost
      port: 8500

  - name: get main_repo key from consul
    consul_kv:
      key: tsugi/{{ lookup('env', 'ROLE') }}/main_repo
    register: main_repo

  - name: git clone the main repo to /var/www/html
    git:
      repo: "{{ main_repo['data']['Value'] }}"
      dest: /var/www/html
      force: yes

  - name: change ownership of html directory
    file:
      state: directory
      path: /var/www/html
      owner: www-data
      group: www-data
      recurse: yes
